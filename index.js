list = [
    ["ax", "Aaland Islands                                  "],
    ["af", "Afghanistan                                     "],
    ["al", "Albania                                         "],
    ["dz", "Algeria                                         "],
    ["as", "American Samoa                                  "],
    ["ad", "Andorra                                         "],
    ["ao", "Angola                                          "],
    ["ai", "Anguilla                                        "],
    ["aq", "Antarctica                                      "],
    ["ag", "Antigua and Barbuda                             "],
    ["ar", "Argentina                                       "],
    ["am", "Armenia                                         "],
    ["aw", "Aruba                                           "],
    ["au", "Australia                                       "],
    ["at", "Austria                                         "],
    ["az", "Azerbaijan                                      "],
    ["bs", "Bahamas                                         "],
    ["bh", "Bahrain                                         "],
    ["bd", "Bangladesh                                      "],
    ["bb", "Barbados                                        "],
    ["by", "Belarus                                         "],
    ["be", "Belgium                                         "],
    ["bz", "Belize                                          "],
    ["bj", "Benin                                           "],
    ["bm", "Bermuda                                         "],
    ["bt", "Bhutan                                          "],
    ["bo", "Bolivia                                         "],
    ["ba", "Bosnia and Herzegowina                          "],
    ["bw", "Botswana                                        "],
    ["bv", "Bouvet Island                                   "],
    ["br", "Brazil                                          "],
    ["io", "British Indian Ocean Territory                  "],
    ["bn", "Brunei Darussalam                               "],
    ["bg", "Bulgaria                                        "],
    ["bf", "Burkina Faso                                    "],
    ["bi", "Burundi                                         "],
    ["kh", "Cambodia                                        "],
    ["cm", "Cameroon                                        "],
    ["ca", "Canada                                          "],
    ["cv", "Cape Verde                                      "],
    ["ky", "Cayman Islands                                  "],
    ["cf", "Central African Republic                        "],
    ["td", "Chad                                            "],
    ["cl", "Chile                                           "],
    ["cn", "China                                           "],
    ["cx", "Christmas Island                                "],
    ["cc", "Cocos (keeling) Islands                         "],
    ["co", "Colombia                                        "],
    ["km", "Comoros                                         "],
    ["cd", "Congo, Democratic Republic of (was Zaire)       "],
    ["cg", "Congo, Republic of                              "],
    ["ck", "Cook Islands                                    "],
    ["cr", "Costa Rica                                      "],
    ["ci", "Cote D'ivoire                                   "],
    ["hr", "Croatia (local name: Hrvatska)                  "],
    ["cu", "Cuba                                            "],
    ["cy", "Cyprus                                          "],
    ["cz", "Czech Republic                                  "],
    ["dk", "Denmark                                         "],
    ["dj", "Djibouti                                        "],
    ["dm", "Dominica                                        "],
    ["do", "Dominican Republic                              "],
    ["ec", "Ecuador                                         "],
    ["eg", "Egypt                                           "],
    ["sv", "El Salvador                                     "],
    ["gq", "Equatorial Guinea                               "],
    ["er", "Eritrea                                         "],
    ["ee", "Estonia                                         "],
    ["et", "Ethiopia                                        "],
    ["fk", "Falkland Islands (malvinas)                     "],
    ["fo", "Faroe Islands                                   "],
    ["fj", "Fiji                                            "],
    ["fi", "Finland                                         "],
    ["fr", "France                                          "],
    ["gf", "French Guiana                                   "],
    ["pf", "French Polynesia                                "],
    ["tf", "French Southern Territories                     "],
    ["ga", "Gabon                                           "],
    ["gm", "Gambia                                          "],
    ["ge", "Georgia                                         "],
    ["de", "Germany                                         "],
    ["gh", "Ghana                                           "],
    ["gi", "Gibraltar                                       "],
    ["gr", "Greece                                          "],
    ["gl", "Greenland                                       "],
    ["gd", "Grenada                                         "],
    ["gp", "Guadeloupe                                      "],
    ["gu", "Guam                                            "],
    ["gt", "Guatemala                                       "],
    ["gn", "Guinea                                          "],
    ["gw", "Guinea-bissau                                   "],
    ["gy", "Guyana                                          "],
    ["ht", "Haiti                                           "],
    ["hm", "Heard and Mc Donald Islands                     "],
    ["hn", "Honduras                                        "],
    ["hk", "Hong Kong                                       "],
    ["hu", "Hungary                                         "],
    ["is", "Iceland                                         "],
    ["in", "India                                           "],
    ["id", "Indonesia                                       "],
    ["ir", "Iran (islamic Republic of)                      "],
    ["iq", "Iraq                                            "],
    ["ie", "Ireland                                         "],
    ["il", "Israel                                          "],
    ["it", "Italy                                           "],
    ["jm", "Jamaica                                         "],
    ["jp", "Japan                                           "],
    ["jo", "Jordan                                          "],
    ["kz", "Kazakhstan                                      "],
    ["ke", "Kenya                                           "],
    ["ki", "Kiribati                                        "],
    ["kp", "Korea, Democratic People's Republic of          "],
    ["kr", "Korea, Republic of                              "],
    ["kw", "Kuwait                                          "],
    ["kg", "Kyrgyzstan                                      "],
    ["la", "Lao People's Democratic Republic                "],
    ["lv", "Latvia                                          "],
    ["lb", "Lebanon                                         "],
    ["ls", "Lesotho                                         "],
    ["lr", "Liberia                                         "],
    ["ly", "Libyan Arab Jamahiriya                          "],
    ["li", "Liechtenstein                                   "],
    ["lt", "Lithuania                                       "],
    ["lu", "Luxembourg                                      "],
    ["mo", "Macau                                           "],
    ["mk", "Macedonia, The Former Yugoslav Republic of      "],
    ["mg", "Madagascar                                      "],
    ["mw", "Malawi                                          "],
    ["my", "Malaysia                                        "],
    ["mv", "Maldives                                        "],
    ["ml", "Mali                                            "],
    ["mt", "Malta                                           "],
    ["mh", "Marshall Islands                                "],
    ["mq", "Martinique                                      "],
    ["mr", "Mauritania                                      "],
    ["mu", "Mauritius                                       "],
    ["yt", "Mayotte                                         "],
    ["mx", "Mexico                                          "],
    ["fm", "Micronesia, Federated States of                 "],
    ["md", "Moldova, Republic of                            "],
    ["mc", "Monaco                                          "],
    ["mn", "Mongolia                                        "],
    ["ms", "Montserrat                                      "],
    ["ma", "Morocco                                         "],
    ["mz", "Mozambique                                      "],
    ["mm", "Myanmar                                         "],
    ["na", "Namibia                                         "],
    ["nr", "Nauru                                           "],
    ["np", "Nepal                                           "],
    ["nl", "Netherlands                                     "],
    ["an", "Netherlands Antilles                            "],
    ["nc", "New Caledonia                                   "],
    ["nz", "New Zealand                                     "],
    ["ni", "Nicaragua                                       "],
    ["ne", "Niger                                           "],
    ["ng", "Nigeria                                         "],
    ["nu", "Niue                                            "],
    ["nf", "Norfolk Island                                  "],
    ["mp", "Northern Mariana Islands                        "],
    ["no", "Norway                                          "],
    ["om", "Oman                                            "],
    ["pk", "Pakistan                                        "],
    ["pw", "Palau                                           "],
    ["ps", "Palestinian Territory, Occupied                 "],
    ["pa", "Panama                                          "],
    ["pg", "Papua New Guinea                                "],
    ["py", "Paraguay                                        "],
    ["pe", "Peru                                            "],
    ["ph", "Philippines                                     "],
    ["pn", "Pitcairn                                        "],
    ["pl", "Poland                                          "],
    ["pt", "Portugal                                        "],
    ["pr", "Puerto Rico                                     "],
    ["qa", "Qatar                                           "],
    ["re", "Reunion                                         "],
    ["ro", "Romania                                         "],
    ["ru", "Russian Federation                              "],
    ["rw", "Rwanda                                          "],
    ["sh", "Saint Helena                                    "],
    ["kn", "Saint Kitts and Nevis                           "],
    ["lc", "Saint Lucia                                     "],
    ["pm", "Saint Pierre and Miquelon                       "],
    ["vc", "Saint Vincent and The Grenadines                "],
    ["ws", "Samoa                                           "],
    ["sm", "San Marino                                      "],
    ["st", "Sao Tome and Principe                           "],
    ["sa", "Saudi Arabia                                    "],
    ["sn", "Senegal                                         "],
    ["cs", "Serbia and Montenegro                           "],
    ["sc", "Seychelles                                      "],
    ["sl", "Sierra Leone                                    "],
    ["sg", "Singapore                                       "],
    ["sk", "Slovakia                                        "],
    ["si", "Slovenia                                        "],
    ["sb", "Solomon Islands                                 "],
    ["so", "Somalia                                         "],
    ["za", "South Africa                                    "],
    ["gs", "South Georgia and The South Sandwich Islands    "],
    ["es", "Spain                                           "],
    ["lk", "Sri Lanka                                       "],
    ["sd", "Sudan                                           "],
    ["sr", "Suriname                                        "],
    ["sj", "Svalbard and Jan Mayen Islands                  "],
    ["sz", "Swaziland                                       "],
    ["se", "Sweden                                          "],
    ["ch", "Switzerland                                     "],
    ["sy", "Syrian Arab Republic                            "],
    ["tw", "Taiwan                                          "],
    ["tj", "Tajikistan                                      "],
    ["tz", "Tanzania, United Republic of                    "],
    ["th", "Thailand                                        "],
    ["tl", "Timor-leste                                     "],
    ["tg", "Togo                                            "],
    ["tk", "Tokelau                                         "],
    ["to", "Tonga                                           "],
    ["tt", "Trinidad and Tobago                             "],
    ["tn", "Tunisia                                         "],
    ["tr", "Turkey                                          "],
    ["tm", "Turkmenistan                                    "],
    ["tc", "Turks and Caicos Islands                        "],
    ["tv", "Tuvalu                                          "],
    ["ug", "Uganda                                          "],
    ["ua", "Ukraine                                         "],
    ["ae", "United Arab Emirates                            "],
    ["gb", "United Kingdom                                  "],
    ["us", "United States                                   "],
    ["um", "United States Minor Outlying Islands            "],
    ["uy", "Uruguay                                         "],
    ["uz", "Uzbekistan                                      "],
    ["vu", "Vanuatu                                         "],
    ["va", "Vatican City State (holy See)                   "],
    ["ve", "Venezuela                                       "],
    ["vn", "Viet Nam                                        "],
    ["vg", "Virgin Islands (british)                        "],
    ["vi", "Virgin Islands (u.s.)                           "],
    ["wf", "Wallis and Futuna Islands                       "],
    ["eh", "Western Sahara                                  "],
    ["ye", "Yemen                                           "],
    ["zm", "Zambia                                          "],
    ["zw", "Zimbabwe                                        "]
]

var lastCountry = "";
var usedCountry = new Set();
var answerIndex = 0;
var score = 0;
var correctSound;
var wrongSound;

function sound(src) {
    this.sound = document.createElement("audio");
    this.sound.src = src;
    this.sound.setAttribute("preload", "auto");
    this.sound.setAttribute("controls", "none");
    this.sound.style.display = "none";
    document.body.appendChild(this.sound);
    this.play = function() {
        this.sound.play();
    }
    this.stop = function() {
        this.sound.pause();
    }
}

function randomInt(min, max) {
    return Math.floor(Math.random() * (max + 1)) + min;
}

function randomCountry() {
    let country = list[randomInt(0, 239)];
    if (usedCountry.has(country)) {
        country = list[randomInt(0, 239)];
    }
    usedCountry.add(country)
    return country;
}

function randomOption() {
    return list[randomInt(0, 239)];
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function start() {
    correctSound = new sound("./correct_answer.mp3");
    wrongSound = new sound("./wrong_answer.mp3");
    document.getElementById("result").style.display = "none";
    document.getElementById("start").style.display = "none";
    document.getElementById("game").style.display = "";
    let countDown = 10;
    score = 0;
    document.getElementById("countDown").innerHTML = countDown;
    document.getElementById("gameScore").innerHTML = "Score: " + score;
    let sid = setInterval(function() {
        // Display the result in the element with id="demo"
        countDown = countDown - 1;
        document.getElementById("countDown").innerHTML = countDown;
        if (countDown == 0) {
            clearInterval(sid);
            document.getElementById("game").style.display = "none";
            document.getElementById("result").style.display = "";
            document.getElementById("resultScore").innerHTML = "Score: " + score;
        }
    }, 1000);
}

function answer(ans) {
    // Scoring
    if (ans == answerIndex) {
        score = score + 1;
        correctSound.play();
    } else {
        wrongSound.play();
    }
    document.getElementById("gameScore").innerHTML = "Score: " + score;

    // Generate quiz
    let quizCountry = randomCountry();
    document.getElementById("quiz").innerHTML = quizCountry[1];
    document.getElementById("flag").src = "./png1000px/" + quizCountry[0] + ".png";
    lastCountry = quizCountry;

    // Generate options
    let optionSet = new Set();
    optionSet.add(quizCountry[1]);
    while (optionSet.size < 4) {
        optionSet.add(randomOption()[1]);
    }
    let optionArray = [...optionSet];
    answerIndex = randomInt(0, 3);
    [optionArray[0], optionArray[answerIndex]] = [optionArray[answerIndex], optionArray[0]];
    for (let i = 0; i < 4; i++) {
        document.getElementById("opt" + String(i)).innerHTML = optionArray[i];
    }

    // Debug message
    // document.getElementById("debug").innerHTML = nextAnswer
}
